import{html as m,nothing as Ze,render as Ge}from"lit-html";import{ifDefined as Ye}from"lit-html/directives/if-defined.js";import{classMap as $t}from"lit-html/directives/class-map.js";import{ProviderRpcClient as Xe}from"everscale-inpage-provider";import{action as dt,makeObservable as Gt,observable as pt,toJS as Yt}from"mobx";var R=function(i,t,e,n){var r=arguments.length,o=r<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,e):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,t,e,n);else for(var l=i.length-1;l>=0;l--)(a=i[l])&&(o=(r<3?a(o):r>3?a(t,e,o):a(t,e))||o);return r>3&&o&&Object.defineProperty(t,e,o),o},S=function(i,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,t)},w=class{_data={};_state={};constructor(t){Gt(this,void 0,t)}setData(t,e){return typeof t=="function"?(this._data=t({...this._data}),this):typeof t=="string"?(this._data={...this._data,[t]:e},this):(typeof t=="object"&&!Array.isArray(t)&&(this._data={...this._data,...t}),this)}setState(t,e){return typeof t=="function"?(this._state=t({...this._state}),this):typeof t=="string"?(this._state={...this._state,[t]:e},this):(typeof t=="object"&&!Array.isArray(t)&&(this._state={...this._state,...t}),this)}toJSON(){return Yt(this._data)}};R([pt,S("design:type",Object)],w.prototype,"_data",void 0);R([pt,S("design:type",Object)],w.prototype,"_state",void 0);R([dt.bound,S("design:type",Function),S("design:paramtypes",[Object,Object]),S("design:returntype",Object)],w.prototype,"setData",null);R([dt.bound,S("design:type",Function),S("design:paramtypes",[Object,Object]),S("design:returntype",Object)],w.prototype,"setState",null);var C;(function(i){i[i.EverscaleMainnet=42]="EverscaleMainnet",i[i.VenomMainnet=1]="VenomMainnet",i[i.VenomTestnet=1e3]="VenomTestnet",i[i.TychoTestnet=2e3]="TychoTestnet"})(C||(C={}));var lt;(function(i){i.ASCENDING="ASC",i.DESCENDING="DESC"})(lt||(lt={}));var ut="#3e8c3e",ht="#fab254",mt="#d33131";function D(i="inherit"){return` background-color: ${i}50; border-left: 3px solid ${i}; border-radius: 2px; display: inline; font-size: 1em; font-weight: bold; line-height: 1rem; padding: 3px 4px 0 4px`}var ii=D("#767676"),O=D(ut),W=D(ht),z=D(mt),M=`color: ${ut}; display: inline; font-weight: 400;`,ni=`color: ${ht}; display: inline; font-weight: 400;`,oi=`color: ${mt}; display: inline; font-weight: 400;`,g="color: inherit; display: inline; font-weight: 400;";import{AddressLiteral as ft}from"everscale-inpage-provider";var ai=new ft("0:0000000000000000000000000000000000000000000000000000000000000000"),ci=new ft("0:000000000000000000000000000000000000000000000000000000000000dead");var B=9;var di=3.1536*10**7;import"@broxus/js-utils";import{Address as gt}from"everscale-inpage-provider";import{Address as Xt}from"everscale-inpage-provider";function vt(i,t=!0){return i==null?!1:i instanceof Xt?!0:typeof i=="string"?t?/^(?:0|-1):[0-9a-fA-F]{64}$/.test(i):/^0:[0-9a-fA-F]{64}$/.test(i):!1}function x(i){if(i instanceof gt)return i;if(!vt(i))throw new Error(`${i} is not a TVM-like address`);return new gt(i)}var V=new Map,Ht=10*1e3;async function yt(i,t,e){let n=t.toString().toLowerCase();try{let r=V.get(n);if(r&&!e?.force){let a=e?.ttl??Ht,{state:l,timestamp:_}=r;if(Date.now()-_<a&&l)return await l}let o=i.getFullContractState({address:x(t)}).then(a=>a.state).catch(a=>{throw V.delete(n),a});return V.set(n,{state:o,timestamp:Date.now()}),await o}catch{V.delete(n);return}}function k(i,t){return i!==void 0&&i?.toString().toLowerCase()===t?.toString().toLowerCase()}import{AddressLiteral as ke}from"everscale-inpage-provider";import{debounce as ie,debug as Y,error as ne,isBrowser as X,throwException as G,timeoutPromise as oe}from"@broxus/js-utils";import{ProviderRpcClient as It,StaticProviderAdapter as re}from"everscale-inpage-provider";import{action as se,makeObservable as ae,runInAction as ce}from"mobx";import{debounce as wt,debug as A,error as Qt,groupCollapsed as qt,groupEnd as Kt,timeoutPromise as bt}from"@broxus/js-utils";import{action as b,computed as P,makeObservable as Jt,observable as te}from"mobx";var f=function(i,t,e,n){var r=arguments.length,o=r<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,e):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,t,e,n);else for(var l=i.length-1;l>=0;l--)(a=i[l])&&(o=(r<3?a(o):r>3?a(t,e,o):a(t,e))||o);return r>3&&o&&Object.defineProperty(t,e,o),o},c=function(i,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,t)},u=class extends w{params;provider;constructor(t){super(),this.params=t,Jt(this)}async connect(t){if(!this.provider)throw new Error("Provider is not defined");try{this.setState("isConnecting",!0),await this.provider.hasProvider();let e=await bt(this.provider.getProviderState(),2e3).catch(()=>{});if(e?.permissions.accountInteraction){this.setData({account:e.permissions.accountInteraction,chainId:Math.abs(e.networkId),version:e.version}),this.setState({isConnecting:!1,isInitialized:!0});return}await this.stopSubscriptions(),await this.runSubscriptions();let n=await this.provider.requestPermissions({permissions:["basic","accountInteraction"]});this.setData("account",n.accountInteraction),e=await bt(this.provider.getProviderState(),2e3);let r=Math.abs(e.networkId),o=typeof t=="number"?t:t?.networkId,a=this.params?.info?.name??this.constructor.name??this.constructor.prototype.name;if(!o||r===o){this.setData({chainId:Math.abs(e.networkId),version:e.version}),this.setState({isConnecting:!1,isInitialized:!0}),A(`${a} connection has skipped network switching.`);return}if(!t){A(`${a} connection has skipped network switching. Chain params or chainId is not provided.`);return}A(`${a} connection trying to switch network.`),await this.switchNetwork(t).then(async()=>{await this.connect(t)}).catch(async()=>{await this.connect()})}catch(e){throw this.setState("isConnecting",!1),await this.stopSubscriptions(),e}}async disconnect(t){if(!((this.isConnecting||this.isDisconnecting)&&!t))try{this.setState("isDisconnecting",!0),await this.provider?.disconnect(),await this.stopSubscriptions(),this.setData(()=>({}))}catch(e){qt(`%c${this.constructor.name}%c Wallet disconnecting error`,z,g),Qt(e),Kt()}finally{this.setState("isDisconnecting",!1)}}async addAsset(t,e="tip3_token"){if(!this.provider)throw new Error("Provider is not defined");if(!this.account?.address)throw new Error("No connected account");return(await this.provider.addAsset({account:this.account.address,params:{rootContract:x(t)},type:e})).newAsset}async addNetwork(t,e){if(!this.provider)throw new Error("Provider is not defined");return(await this.provider.addNetwork({network:t,switchNetwork:e})).network}async switchNetwork(t){if(!this.provider)throw new Error("Provider is not defined");let e=typeof t=="number"?t:t.networkId,n=await this.provider.changeNetwork({networkId:e});return n.network==null&&typeof t!="number"&&(n.network=await this.addNetwork(t,!0)),n.network}get account(){return this._data.account}get chainId(){return this._data.chainId}get version(){return this._data.version}get isConnecting(){return this._state.isConnecting}get isDisconnecting(){return this._state.isDisconnecting}get isInitialized(){return this._state.isInitialized}get isInitializing(){return this._state.isInitializing}async handlePermissionsChanged(t){let e=t.permissions.accountInteraction;if(!e){A(`%c${this.constructor.name}%c Permissions have been revoked. Disconnect dApp!`,W,g),await this.disconnect();return}k(this.account?.address,e.address)||(this.setData("account",e),A(`%c${this.constructor.name}%c Permissions have been changed`,W,g))}async handleNetworkChanged(t){let e=Math.abs(t.networkId);this.chainId!==e&&(A(`%c${this.constructor.name}%c Network has been changed from ${this.chainId} to ${e}`,W,g),this.setData("chainId",e))}handleDisconnected(t){this.setData(()=>({})),this.params?.onDisconnect?.(t)}async runSubscriptions(){A("runSubscriptions",this.constructor.name);let[t,e]=await Promise.all([this.provider?.subscribe("networkChanged"),this.provider?.subscribe("permissionsChanged")]);this.networkChangeSubscription=t,this.permissionsSubscription=e,this.networkChangeSubscription?.on("data",wt(this.handleNetworkChanged,400)),this.permissionsSubscription?.on("data",wt(this.handlePermissionsChanged,400))}async stopSubscriptions(){await Promise.allSettled([this.networkChangeSubscription?.unsubscribe(),this.permissionsSubscription?.unsubscribe()]),this.networkChangeSubscription=void 0,this.permissionsSubscription=void 0}networkChangeSubscription;permissionsSubscription};f([te,c("design:type",Function)],u.prototype,"provider",void 0);f([b.bound,c("design:type",Function),c("design:paramtypes",[Object]),c("design:returntype",Promise)],u.prototype,"connect",null);f([b.bound,c("design:type",Function),c("design:paramtypes",[Boolean]),c("design:returntype",Promise)],u.prototype,"disconnect",null);f([b.bound,c("design:type",Function),c("design:paramtypes",[Object,String]),c("design:returntype",Promise)],u.prototype,"addAsset",null);f([b.bound,c("design:type",Function),c("design:paramtypes",[Object,Boolean]),c("design:returntype",Promise)],u.prototype,"addNetwork",null);f([b.bound,c("design:type",Function),c("design:paramtypes",[Object]),c("design:returntype",Promise)],u.prototype,"switchNetwork",null);f([P,c("design:type",Object),c("design:paramtypes",[])],u.prototype,"account",null);f([P,c("design:type",Object),c("design:paramtypes",[])],u.prototype,"chainId",null);f([P,c("design:type",Object),c("design:paramtypes",[])],u.prototype,"version",null);f([P,c("design:type",Object),c("design:paramtypes",[])],u.prototype,"isConnecting",null);f([P,c("design:type",Object),c("design:paramtypes",[])],u.prototype,"isDisconnecting",null);f([P,c("design:type",Object),c("design:paramtypes",[])],u.prototype,"isInitialized",null);f([P,c("design:type",Object),c("design:paramtypes",[])],u.prototype,"isInitializing",null);f([b.bound,c("design:type",Function),c("design:paramtypes",[Object]),c("design:returntype",Promise)],u.prototype,"handlePermissionsChanged",null);f([b.bound,c("design:type",Function),c("design:paramtypes",[Object]),c("design:returntype",Promise)],u.prototype,"handleNetworkChanged",null);f([b.bound,c("design:type",Function),c("design:paramtypes",[Error]),c("design:returntype",void 0)],u.prototype,"handleDisconnected",null);f([b.bound,c("design:type",Function),c("design:paramtypes",[]),c("design:returntype",Promise)],u.prototype,"runSubscriptions",null);f([b.bound,c("design:type",Function),c("design:paramtypes",[]),c("design:returntype",Promise)],u.prototype,"stopSubscriptions",null);var I;(function(i){i.NEKOTON_WALLET="NEKOTON_WALLET",i.NEKOTON_ADAPTER="NEKOTON_ADAPTER",i.EXTERNAL_APP="EXTERNAL_APP"})(I||(I={}));var y;(function(i){i.SPARX_WALLET="com.sparxwallet",i.SPARX_WALLET_MOBILE="com.broxus.sparx.app",i.EVER_WALLET="net.everwallet",i.EVER_WALLET_MOBILE="com.broxus.crystal.app",i.VENOM_WALLET="com.venomwallet",i.VENOM_WALLET_MOBILE="com.venom.wallet"})(y||(y={}));var v;(function(i){i.REQUEST_PROVIDER="tvm:requestProvider",i.ANNOUNCE_PROVIDER="tvm:announceProvider"})(v||(v={}));var ee=function(i,t,e,n){var r=arguments.length,o=r<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,e):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,t,e,n);else for(var l=i.length-1;l>=0;l--)(a=i[l])&&(o=(r<3?a(o):r>3?a(t,e,o):a(t,e))||o);return r>3&&o&&Object.defineProperty(t,e,o),o},Z=function(i,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,t)},de=i=>async t=>new Promise((e,n)=>{if(t)e(t);else{let r=i?.fallbackAttempts??5,o=0,a=ie(()=>{if(o>=r){n(new Error(`Max attempts (${r}) is reached.`));return}if(X()&&window.__ever){Y("EVER Wallet provider was found with fallback",window.__ever),e(window.__ever);return}o+=1,a()},1e3);a()}}),pe=[y.EVER_WALLET.toString(),y.EVER_WALLET_MOBILE.toString()],j=class extends u{params;name="EverWallet";type=I.NEKOTON_WALLET;constructor(t){super(t),this.params=t,ae(this),(t?.autoInit??!0)&&this.init().catch(ne)}async init(){let t,e=async n=>{let{name:r,rdns:o}=n.detail.info;(r==="EVER Wallet"||o&&pe.includes(o))&&(window.removeEventListener(v.ANNOUNCE_PROVIDER,e),t=new It({provider:new re(n.detail.provider)}),Y("EVER Wallet provider event was captured",n))};try{if(this.setState("isInitializing",!0),X()&&(window.addEventListener(v.ANNOUNCE_PROVIDER,e),window.dispatchEvent(new Event(v.REQUEST_PROVIDER))),!t)if(this.params?.fallbackProviderFactory)t=await this.params.fallbackProviderFactory();else{let o=await this.params?.options?.provider??await de({fallbackAttempts:this.params?.fallbackAttempts})();o||G("No provider found"),t=new It({provider:o})}await t.hasProvider()||G("No provider found"),ce(()=>{this.provider=t,X()&&window.removeEventListener(v.ANNOUNCE_PROVIDER,e)});let r=await oe(t.getProviderState(),2e3);r.permissions.accountInteraction||G("No permissions returned"),this.setData({account:r.permissions.accountInteraction,chainId:Math.abs(r.networkId),version:r.version}),this.setState({isInitialized:!0,isInitializing:!1}),await this.runSubscriptions()}catch(n){Y("Ever Wallet could not be pre-connected",n),this.setState({isInitialized:!1,isInitializing:!1}),await this.stopSubscriptions()}return this.provider}};ee([se.bound,Z("design:type",Function),Z("design:paramtypes",[]),Z("design:returntype",Promise)],j.prototype,"init",null);import{debounce as ue,debug as q,error as he,isBrowser as K,throwException as Q,timeoutPromise as me}from"@broxus/js-utils";import{ProviderRpcClient as Et,StaticProviderAdapter as fe}from"everscale-inpage-provider";import{action as ve,makeObservable as ge,runInAction as ye}from"mobx";var le=function(i,t,e,n){var r=arguments.length,o=r<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,e):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,t,e,n);else for(var l=i.length-1;l>=0;l--)(a=i[l])&&(o=(r<3?a(o):r>3?a(t,e,o):a(t,e))||o);return r>3&&o&&Object.defineProperty(t,e,o),o},H=function(i,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,t)},we=i=>async t=>new Promise((e,n)=>{if(t)e(t);else{let r=i?.fallbackAttempts??5,o=0,a=ue(()=>{if(o>=r){n(new Error(`Max attempts (${r}) is reached.`));return}if(K()&&window.__sparx){q("SparX Wallet provider was found with fallback",window.__sparx),e(window.__sparx);return}o+=1,a()},1e3);a()}}),be=[y.SPARX_WALLET.toString(),y.SPARX_WALLET_MOBILE.toString()],T=class extends u{params;name="SparXWallet";type=I.NEKOTON_WALLET;constructor(t){super(t),this.params=t,ge(this),(t?.autoInit??!0)&&this.init().catch(he)}async init(){let t,e=async n=>{let{name:r,rdns:o}=n.detail.info;(r==="SparX Wallet"||o&&be.includes(o))&&(window.removeEventListener(v.ANNOUNCE_PROVIDER,e),t=new Et({provider:new fe(n.detail.provider)}),q("SparX Wallet provider event was captured",n))};try{if(this.setState("isInitializing",!0),K()&&(window.addEventListener(v.ANNOUNCE_PROVIDER,e),window.dispatchEvent(new Event(v.REQUEST_PROVIDER))),!t)if(this.params?.fallbackProviderFactory)t=await this.params.fallbackProviderFactory();else{let o=await this.params?.options?.provider??await we({fallbackAttempts:this.params?.fallbackAttempts})();o||Q("No provider found"),t=new Et({provider:o})}await t.hasProvider()||Q("No provider found"),ye(()=>{this.provider=t,K()&&window.removeEventListener(v.ANNOUNCE_PROVIDER,e)});let r=await me(t.getProviderState(),2e3);r.permissions.accountInteraction||Q("No permissions returned"),this.setData({account:r.permissions.accountInteraction,chainId:Math.abs(r.networkId),version:r.version}),this.setState({isInitialized:!0,isInitializing:!1}),await this.runSubscriptions()}catch(n){q("SparX Wallet could not be pre-connected",n),this.setState({isInitialized:!1,isInitializing:!1}),await this.stopSubscriptions()}return this.provider}};le([ve.bound,H("design:type",Function),H("design:paramtypes",[]),H("design:returntype",Promise)],T.prototype,"init",null);import{debounce as Ee,debug as et,error as Se,isBrowser as it,throwException as tt,timeoutPromise as Ce}from"@broxus/js-utils";import{ProviderRpcClient as St,StaticProviderAdapter as Ae}from"everscale-inpage-provider";import{action as Pe,makeObservable as _e,runInAction as xe}from"mobx";var Ie=function(i,t,e,n){var r=arguments.length,o=r<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,e):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,t,e,n);else for(var l=i.length-1;l>=0;l--)(a=i[l])&&(o=(r<3?a(o):r>3?a(t,e,o):a(t,e))||o);return r>3&&o&&Object.defineProperty(t,e,o),o},J=function(i,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,t)},Ne=i=>async t=>new Promise((e,n)=>{if(t)e(t);else{let r=i?.fallbackAttempts??5,o=0,a=Ee(()=>{if(o>=r){n(new Error(`Max attempts (${r}) is reached.`));return}if(it()&&window.__venom){et("Venom Wallet provider was found with fallback",window.__venom),e(window.__venom);return}o+=1,a()},1e3);a()}}),Me=[y.VENOM_WALLET.toString(),y.VENOM_WALLET_MOBILE.toString()],L=class extends u{params;name="VenomWallet";type=I.NEKOTON_WALLET;constructor(t){super(t),this.params=t,_e(this),(t?.autoInit??!0)&&this.init().catch(Se)}async init(){let t,e=async n=>{let{name:r,rdns:o}=n.detail.info;(r==="Venom Wallet"||o&&Me.includes(o))&&(window.removeEventListener(v.ANNOUNCE_PROVIDER,e),t=new St({provider:new Ae(n.detail.provider)}),et("Venom Wallet provider event was captured",n))};try{if(this.setState("isInitializing",!0),it()&&(window.addEventListener(v.ANNOUNCE_PROVIDER,e),window.dispatchEvent(new Event(v.REQUEST_PROVIDER))),!t)if(this.params?.fallbackProviderFactory)t=await this.params.fallbackProviderFactory();else{let o=await this.params?.options?.provider??await Ne({fallbackAttempts:this.params?.fallbackAttempts})();o||tt("No provider found"),t=new St({provider:o})}await t.hasProvider()||tt("No provider found"),xe(()=>{this.provider=t,it()&&window.removeEventListener(v.ANNOUNCE_PROVIDER,e)});let r=await Ce(t.getProviderState(),2e3);r.permissions.accountInteraction||tt("No permissions returned"),this.setData({account:r.permissions.accountInteraction,chainId:Math.abs(r.networkId),version:r.version}),this.setState({isInitialized:!0,isInitializing:!1}),await this.runSubscriptions()}catch(n){et("Venom Wallet could not be pre-connected",n),this.setState({isInitialized:!1,isInitializing:!1}),await this.stopSubscriptions()}return this.provider}};Ie([Pe.bound,J("design:type",Function),J("design:paramtypes",[]),J("design:returntype",Promise)],L.prototype,"init",null);var $="TVM_RECENT_CONNECTION";var Ct="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIwMCIgaGVpZ2h0PSIxMjAwIiB2aWV3Qm94PSIwIDAgMTIwMCAxMjAwIiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogICAgPHBhdGggZD0iTTAgNjAwQzAgMjY4LjYyOSAyNjguNjMgMCA2MDAgMEM5MzEuMzczIDAgMTIwMCAyNjguNjI5IDEyMDAgNjAwQzEyMDAgOTMxLjM3MyA5MzEuMzczIDEyMDAgNjAwIDEyMDBDMjY4LjYzIDEyMDAgMCA5MzEuMzczIDAgNjAwWiIgZmlsbD0idXJsKCNwYWludDBfbGluZWFyXzQyNF8zKSIvPgogICAgPHBhdGggZD0iTTQ1OS4zIDMwMEwxODcuNSA1NzQuNzkySDYyOS4zMjFWMTAxMi41TDkwMCA3NDEuNjM0VjMwMEg0NTkuM1oiIGZpbGw9IndoaXRlIi8+CiAgICA8ZGVmcz4KICAgICAgICA8bGluZWFyR3JhZGllbnQgaWQ9InBhaW50MF9saW5lYXJfNDI0XzMiIHgxPSIxMjAwIiB5MT0iLTAuMDAwMTI5NTI5IiB4Mj0iMTA5LjEyMyIgeTI9IjEwODIuMjYiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIj4KICAgICAgICAgICAgPHN0b3Agc3RvcC1jb2xvcj0iI0ZGNjkyMiIvPgogICAgICAgICAgICA8c3RvcCBvZmZzZXQ9IjEiIHN0b3AtY29sb3I9IiM2MzQ3RjUiLz4KICAgICAgICA8L2xpbmVhckdyYWRpZW50PgogICAgPC9kZWZzPgo8L3N2Zz4K";var Hi={chainId:C.EverscaleMainnet.toString(),currency:{decimals:B,icon:Ct,name:"Native currency",symbol:"EVER",wrappedCurrencyAddress:new ke("0:a49cd4e158a9a15555e624759e2e4e766d22600b7800d891e46f9291f044a93d")},explorer:{accountsSubPath:"accounts",baseUrl:"https://everscan.io",title:"EVERScan",transactionsSubPath:"transactions"},icon:Ct,id:`tvm-${C.EverscaleMainnet.toString()}`,name:"Everscale",rpcUrl:"https://jrpc.everwallet.net",shortName:"Everscale",type:"tvm"};import{debug as At,isBrowser as Ki,storage as nt}from"@broxus/js-utils";import*as Pt from"react";function je(i){let t={providerId:i.providerId,type:i.type};return!!(t.type&&I[t.type]&&t.providerId)}function ot(i){if(!i){nt.remove($);return}At("Store TVM recent connection",i),nt.set($,JSON.stringify(i))}function U(){let i=nt.get($);if(i){try{let t=JSON.parse(i);if(je(t))return t}catch(t){At(t)}ot(void 0)}}function _t(i){return{config:{explorerBaseUrl:i.explorer.baseUrl,symbol:i.currency.symbol},connection:{data:{endpoint:i.rpcUrl},type:"proto"},name:i.name,networkId:Number(i.chainId)}}import{getUserAgent as N,isAndroid as Te,isBrowser as xt,isChrome as Le,isFirefox as Re,isIos as De,isMobile as Nt}from"@broxus/js-utils";function Mt(i){let[t]=Array.from(new Map([["android",Nt(N())&&Te(N())],["ios",Nt(N())&&De(N())],["chromeExtension",xt()&&Le(N())],["firefoxExtension",xt()&&Re(N())]])).find(([,e])=>e)??[];return t?[t,i[t]]:void 0}function kt(i){return/(EverWalletBrowser|EverWallet)/g.test(i)}function jt(i){return/(SparXWalletBrowser|SparXWallet)/g.test(i)}function Tt(i){return/(VenomWalletBrowser|VenomWallet)/g.test(i)}import{debug as rt,error as F,groupCollapsed as Oe,groupEnd as We,sliceAddress as st}from"@broxus/js-utils";import{ProviderRpcClient as Rt}from"everscale-inpage-provider";import{action as E,comparer as ze,computed as h,makeObservable as Be,reaction as Lt}from"mobx";var p=function(i,t,e,n){var r=arguments.length,o=r<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,e):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,t,e,n);else for(var l=i.length-1;l>=0;l--)(a=i[l])&&(o=(r<3?a(o):r>3?a(t,e,o):a(t,e))||o);return r>3&&o&&Object.defineProperty(t,e,o),o},s=function(i,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,t)},d=class extends w{params;name="TvmWalletService";constructor(t){super(),this.params=t,this.setData(()=>({networks:t?.networks||[]}));let e=t?.providers?.some(n=>n.id===t.providerId);this.setState(()=>({isSyncing:void 0,providerId:e?t?.providerId:void 0})),Be(this),(t?.autoInit??!0)&&this._init().catch(n=>{F("Wallet init failed with an error",n)})}get connector(){return this.providers?.find(t=>t.id===this.providerId)?.connector}async init(){let t=await this.connector?.init();return await this._init(),t}async connect(t){if(!(this.isConnecting||this.isDisconnecting))try{let e=typeof t=="number"?t:t?.networkId??this.params?.defaultNetworkId??this.network?.chainId??C.EverscaleMainnet,n=this.networks.find(o=>o.chainId===e?.toString()),r=typeof t=="object"?t:n?_t(n):void 0;await this.connector?.connect(r??C.EverscaleMainnet)}catch(e){throw F("Tvm Wallet connect error",e),e}}async disconnect(t){if(!((this.isConnecting||this.isDisconnecting)&&!t))try{await this.connector?.disconnect(),this.setData("contractState",void 0)}catch(e){F("TVM Wallet disconnect error",e)}}async addAsset(t,e="tip3_token"){return this.connector?.addAsset(t,e)}async addNetwork(t,e){if(!this.connector)throw new Error("Provider is not defined");return this.connector.addNetwork(t,e)}async switchNetwork(t){if(!this.connector)throw new Error("Provider is not defined");return this.connector.switchNetwork(t)}get connection(){let t=this.params?.connectionParams;return t?.factory?.(this.network)??new Rt({provider:t?.provider})}get provider(){return this.connector?.provider}get contract(){return this._data.contractState}get networks(){return this._data.networks}get isSyncing(){return this._state.isSyncing}get providerId(){return this._state.providerId}get address(){return this.account?.address}get balance(){return this.contract?.balance??"0"}get currency(){return{decimals:this.network?.currency.decimals??B,icon:this.network?.currency.icon,name:this.network?.currency.name,symbol:this.network?.currency.symbol||"EVER",wrappedCurrencyAddress:this.network?.currency.wrappedCurrencyAddress?x(this.network.currency.wrappedCurrencyAddress):void 0}}get hasProvider(){return this.connector?.provider!=null}get isConnected(){return this.address!==void 0}get isOutdated(){let t=this.params?.providers?.find(_=>_.id===this.providerId);if(this.connector?.version===void 0||t?.minVersion===void 0)return!1;let[e="0",n="0",r="0"]=this.connector.version.split("."),[o,a,l]=t.minVersion.split(".");return e<o||e<=o&&n<a||e<=o&&n<=a&&r<l}get isReady(){return!this.isInitializing&&!this.isConnecting&&!this.isDisconnecting&&this.isInitialized===!0&&this.isConnected}get isUnsupportedNetwork(){return this.chainId==null?!1:!(this.networks?.map(t=>t.chainId)?.includes(this.chainId?.toString())??!1)}get network(){let t=this.chainId?.toString()??this.params?.defaultNetworkId?.toString();return this.networks?.find(e=>e.type==="tvm"&&e.chainId===t)}get providerInfo(){return this.providers?.find(t=>t.id===this.providerId)?.info}get providers(){return this.params?.providers??[]}get account(){return this.connector?.account}get chainId(){return this.connector?.chainId}get isConnecting(){return this.connector?.isConnecting}get isDisconnecting(){return this.connector?.isDisconnecting}get isInitialized(){return this.connector?.isInitialized}get isInitializing(){return this.connector?.isInitializing}async syncContractState(t){if(!(!this.provider||!t?.force&&this.isSyncing))try{if(this.account?.address){this.setState("isSyncing",this.isSyncing===void 0);let e=await yt(this.provider,this.account.address,{force:t?.force});this.setData("contractState",e)}}catch(e){throw Oe(`%c${this.constructor.name}%c get account full contract state error`,z,g),F(e),We(),e}finally{this.setState("isSyncing",!1)}}async _init(){this.accountDisposer=Lt(()=>this.address,async(t,e)=>{if(k(t,e)||this.setState("isSyncing",void 0),t){try{await this.watch()}catch{await this.unwatch()}await this.syncContractState({force:!this.isSyncing})}},{equals:ze.shallow}),this.networkDisposer=Lt(()=>this.chainId,async(t,e)=>{if((t!==e||!e)&&(this.setState("isSyncing",void 0),this.address)){try{await this.watch()}catch{await this.unwatch()}await this.syncContractState({force:!0})}})}async watch(){if(!this.provider||!this.address){await this.unwatch();return}await this.unwatch(),this.contractSubscriber=new this.provider.Subscriber,await this.contractSubscriber.states(this.address).delayed(t=>(rt(`%c${this.constructor.name}%c subscribes to the user wallet [%c${st(this.address?.toString())}%c] contract updates`,O,g,M,g),t.on(async e=>{rt(`%c${this.constructor.name}%c %ccontractStateChanged%c event was captured for current connected wallet %c${st(this.address?.toString())}`,O,g,M,g,M,e),k(this.address,e.address)?await this.syncContractState({force:!this.isSyncing}):(await this.contractSubscriber?.unsubscribe(),this.contractSubscriber=void 0)})))}async unwatch(){try{await this.contractSubscriber?.unsubscribe(),rt(`%c${this.constructor.name}%c unsubscribe from the user wallet [%c${st(this.address?.toString())}%c] contract updates`,O,g,M,g),this.contractSubscriber=void 0}catch{this.contractSubscriber=void 0}}accountDisposer;contractSubscriber;networkDisposer};p([h,s("design:type",Object),s("design:paramtypes",[])],d.prototype,"connector",null);p([E.bound,s("design:type",Function),s("design:paramtypes",[]),s("design:returntype",Promise)],d.prototype,"init",null);p([E.bound,s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",Promise)],d.prototype,"connect",null);p([E.bound,s("design:type",Function),s("design:paramtypes",[Boolean]),s("design:returntype",Promise)],d.prototype,"disconnect",null);p([E.bound,s("design:type",Function),s("design:paramtypes",[Object,String]),s("design:returntype",Promise)],d.prototype,"addAsset",null);p([E.bound,s("design:type",Function),s("design:paramtypes",[Object,Boolean]),s("design:returntype",Promise)],d.prototype,"addNetwork",null);p([E.bound,s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",Promise)],d.prototype,"switchNetwork",null);p([h,s("design:type",Rt),s("design:paramtypes",[])],d.prototype,"connection",null);p([h,s("design:type",Object),s("design:paramtypes",[])],d.prototype,"provider",null);p([h,s("design:type",Object),s("design:paramtypes",[])],d.prototype,"contract",null);p([h,s("design:type",Object),s("design:paramtypes",[])],d.prototype,"networks",null);p([h,s("design:type",Object),s("design:paramtypes",[])],d.prototype,"isSyncing",null);p([h,s("design:type",Object),s("design:paramtypes",[])],d.prototype,"providerId",null);p([h,s("design:type",Object),s("design:paramtypes",[])],d.prototype,"address",null);p([h,s("design:type",Object),s("design:paramtypes",[])],d.prototype,"balance",null);p([h,s("design:type",Object),s("design:paramtypes",[])],d.prototype,"currency",null);p([h,s("design:type",Boolean),s("design:paramtypes",[])],d.prototype,"hasProvider",null);p([h,s("design:type",Boolean),s("design:paramtypes",[])],d.prototype,"isConnected",null);p([h,s("design:type",Boolean),s("design:paramtypes",[])],d.prototype,"isOutdated",null);p([h,s("design:type",Boolean),s("design:paramtypes",[])],d.prototype,"isReady",null);p([h,s("design:type",Boolean),s("design:paramtypes",[])],d.prototype,"isUnsupportedNetwork",null);p([h,s("design:type",Object),s("design:paramtypes",[])],d.prototype,"network",null);p([h,s("design:type",Object),s("design:paramtypes",[])],d.prototype,"providerInfo",null);p([h,s("design:type",Object),s("design:paramtypes",[])],d.prototype,"providers",null);p([h,s("design:type",Object),s("design:paramtypes",[])],d.prototype,"account",null);p([h,s("design:type",Object),s("design:paramtypes",[])],d.prototype,"chainId",null);p([h,s("design:type",Object),s("design:paramtypes",[])],d.prototype,"isConnecting",null);p([h,s("design:type",Object),s("design:paramtypes",[])],d.prototype,"isDisconnecting",null);p([h,s("design:type",Object),s("design:paramtypes",[])],d.prototype,"isInitialized",null);p([h,s("design:type",Object),s("design:paramtypes",[])],d.prototype,"isInitializing",null);p([E.bound,s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",Promise)],d.prototype,"syncContractState",null);p([E.bound,s("design:type",Function),s("design:paramtypes",[]),s("design:returntype",Promise)],d.prototype,"_init",null);p([E.bound,s("design:type",Function),s("design:paramtypes",[]),s("design:returntype",Promise)],d.prototype,"watch",null);p([E.bound,s("design:type",Function),s("design:paramtypes",[]),s("design:returntype",Promise)],d.prototype,"unwatch",null);import{autorun as He,makeAutoObservable as Qe,reaction as ct,runInAction as Ut}from"mobx";import{getUserAgent as Ft,isMobile as qe}from"@broxus/js-utils";import{paramsSerializer as Fe}from"@broxus/js-utils";var Dt='data:image/svg+xml,<svg width="1200" height="1200" viewBox="0 0 1200 1200" fill="none" xmlns="http://www.w3.org/2000/svg">%0A    <path d="M1200 600C1200 268.629 931.371 0 600 0C268.629 0 0 268.629 0 600C0 931.371 268.629 1200 600 1200C931.371 1200 1200 931.371 1200 600Z" fill="%23050B2E"/>%0A    <path d="M459.298 300L187.5 574.793H629.323V1012.5L900 741.632V300H459.298Z" fill="%23C5E4F3"/>%0A</svg>%0A';var Ot='data:image/svg+xml,<svg width="1200" height="1200" viewBox="0 0 1200 1200" fill="none" xmlns="http://www.w3.org/2000/svg">%0A    <g clip-path="url(%23clip0_465_2)">%0A        <g filter="url(%23filter0_d_465_2)">%0A            <rect x="20" y="20" width="1160" height="1160" rx="580" fill="%230F1224"/>%0A            <path d="M309.86 842.504L267.058 799.702L377.252 689.508C426.589 640.172 426.589 559.884 377.252 510.548L267 400.296L309.802 357.494L420.054 467.746C492.995 540.687 492.995 659.369 420.054 732.31L309.86 842.504Z" fill="url(%23paint0_linear_465_2)"/>%0A            <path d="M799.702 933L689.508 822.806C640.172 773.47 559.885 773.47 510.549 822.806L400.354 933L357.552 890.198L467.747 780.004C540.688 707.063 659.369 707.063 732.31 780.004L842.504 890.198L799.702 933Z" fill="url(%23paint1_linear_465_2)"/>%0A            <path d="M890.198 842.504L780.004 732.31C707.063 659.369 707.063 540.688 780.004 467.747L890.198 357.552L933 400.354L822.806 510.549C773.47 559.885 773.47 640.172 822.806 689.508L933 799.702L890.198 842.504Z" fill="url(%23paint2_linear_465_2)"/>%0A            <path d="M600.019 474.765C552.114 474.765 504.208 456.535 467.747 420.055L357.495 309.802L400.297 267L510.549 377.253C559.885 426.589 640.173 426.589 689.509 377.253L799.703 267.058L842.505 309.86L732.311 420.055C695.83 456.515 647.944 474.765 600.039 474.765H600.019Z" fill="url(%23paint3_linear_465_2)"/>%0A        </g>%0A    </g>%0A    <defs>%0A        <filter id="filter0_d_465_2" x="-25" y="-25" width="1250" height="1250" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">%0A            <feFlood flood-opacity="0" result="BackgroundImageFix"/>%0A            <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>%0A            <feOffset/>%0A            <feGaussianBlur stdDeviation="22.5"/>%0A            <feComposite in2="hardAlpha" operator="out"/>%0A            <feColorMatrix type="matrix" values="0 0 0 0 0.164706 0 0 0 0 0.741176 0 0 0 0 0.894118 0 0 0 0.1 0"/>%0A            <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_465_2"/>%0A            <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_465_2" result="shape"/>%0A        </filter>%0A        <linearGradient id="paint0_linear_465_2" x1="370.873" y1="839.875" x2="370.873" y2="360.955" gradientUnits="userSpaceOnUse">%0A            <stop stop-color="%2300B2E3" stop-opacity="0"/>%0A            <stop offset="0.07" stop-color="%2305B3E3" stop-opacity="0.03"/>%0A            <stop offset="0.19" stop-color="%2313B7E3" stop-opacity="0.13"/>%0A            <stop offset="0.33" stop-color="%232ABDE4" stop-opacity="0.28"/>%0A            <stop offset="0.49" stop-color="%234AC5E5" stop-opacity="0.49"/>%0A            <stop offset="0.66" stop-color="%2373D0E6" stop-opacity="0.75"/>%0A            <stop offset="0.81" stop-color="%239ADBE8"/>%0A        </linearGradient>%0A        <linearGradient id="paint1_linear_465_2" x1="840.687" y1="829.147" x2="358.461" y2="829.147" gradientUnits="userSpaceOnUse">%0A            <stop stop-color="%2300B2E3" stop-opacity="0"/>%0A            <stop offset="0.07" stop-color="%2305B3E3" stop-opacity="0.03"/>%0A            <stop offset="0.19" stop-color="%2313B7E3" stop-opacity="0.13"/>%0A            <stop offset="0.33" stop-color="%232ABDE4" stop-opacity="0.28"/>%0A            <stop offset="0.49" stop-color="%234AC5E5" stop-opacity="0.49"/>%0A            <stop offset="0.66" stop-color="%2373D0E6" stop-opacity="0.75"/>%0A            <stop offset="0.81" stop-color="%239ADBE8"/>%0A        </linearGradient>%0A        <linearGradient id="paint2_linear_465_2" x1="829.147" y1="358.326" x2="829.147" y2="837.033" gradientUnits="userSpaceOnUse">%0A            <stop stop-color="%2300B2E3" stop-opacity="0"/>%0A            <stop offset="0.07" stop-color="%2305B3E3" stop-opacity="0.03"/>%0A            <stop offset="0.19" stop-color="%2313B7E3" stop-opacity="0.13"/>%0A            <stop offset="0.33" stop-color="%232ABDE4" stop-opacity="0.28"/>%0A            <stop offset="0.49" stop-color="%234AC5E5" stop-opacity="0.49"/>%0A            <stop offset="0.66" stop-color="%2373D0E6" stop-opacity="0.75"/>%0A            <stop offset="0.81" stop-color="%239ADBE8"/>%0A        </linearGradient>%0A        <linearGradient id="paint3_linear_465_2" x1="356.296" y1="370.873" x2="842.776" y2="370.873" gradientUnits="userSpaceOnUse">%0A            <stop stop-color="%2300B2E3" stop-opacity="0"/>%0A            <stop offset="0.07" stop-color="%2305B3E3" stop-opacity="0.03"/>%0A            <stop offset="0.19" stop-color="%2313B7E3" stop-opacity="0.13"/>%0A            <stop offset="0.33" stop-color="%232ABDE4" stop-opacity="0.28"/>%0A            <stop offset="0.49" stop-color="%234AC5E5" stop-opacity="0.49"/>%0A            <stop offset="0.66" stop-color="%2373D0E6" stop-opacity="0.75"/>%0A            <stop offset="0.81" stop-color="%239ADBE8"/>%0A        </linearGradient>%0A        <clipPath id="clip0_465_2">%0A            <rect width="1200" height="1200" fill="white"/>%0A        </clipPath>%0A    </defs>%0A</svg>%0A';var Wt='data:image/svg+xml,<svg width="1200" height="1200" viewBox="0 0 1200 1200" fill="none" xmlns="http://www.w3.org/2000/svg">%0A    <path d="M600 1200C931.371 1200 1200 931.371 1200 600C1200 268.629 931.371 0 600 0C268.629 0 0 268.629 0 600C0 931.371 268.629 1200 600 1200Z" fill="%234C5AF5"/>%0A    <path d="M878.122 238.043C855.787 234.439 832.901 236.491 811.575 244.007C790.245 251.525 771.157 264.266 756.071 281.058C727.275 313.2 718.316 355.045 725.231 396.979C731.494 434.794 739.804 473.175 741.675 509.606C744.289 564.476 735.904 619.313 717.011 670.924C699.915 717.619 675.559 753.833 623.362 761.846C619.492 762.454 605.4 762.885 601.395 763.103C597.394 763.32 584.737 762.495 580.822 761.891C528.626 753.878 504.052 717.664 487.001 670.661C468.105 619.054 459.724 564.214 462.337 509.344C464.209 473.044 472.515 434.621 478.777 396.716C485.696 354.785 476.734 312.94 447.941 280.798C432.806 264.018 413.67 251.306 392.302 243.833C370.932 236.361 348.017 234.369 325.671 238.043C258.729 248.916 214.145 308.088 213.754 370.163C213.567 394.08 220.09 417.574 232.588 438C253.423 472.223 287.611 497.171 317.45 523.076C337.197 540.405 371.343 589.571 388.087 642.851C398.224 675.124 406.489 707.828 414.664 740.839C426.15 786.84 441.937 888.465 452.332 934.601C473.081 1026.96 536.587 1047.88 600.221 1050H602.482C666.12 1047.88 730.669 1026.91 751.417 934.556C761.767 888.424 777.514 786.754 789.086 740.794C797.306 707.959 805.526 675.079 815.662 642.81C832.406 589.526 866.554 540.188 886.301 523.035C916.14 497.044 950.284 472.178 971.164 437.955C983.659 417.533 990.184 394.039 989.996 370.12C989.647 307.915 945.236 248.699 878.122 238.043Z" fill="white"/>%0A</svg>%0A';var at=()=>({connector:new T,id:"SparXWallet",info:{description:"Your universal tool for TVM",icon:Ot,links:{android:"https://play.google.com/store/apps/details?id=com.broxus.sparx.app",homepage:"https://sparxwallet.com/",chromeExtension:"https://chrome.google.com/webstore/detail/sparx-wallet/aijecocmefcagpmbpjcfjjbcclfmobgf",ios:"https://apps.apple.com/us/app/sparx-tvm-wallet/id6670219321",universalLink:Vt("https://l.sparxwallet.com",{apn:"com.broxus.sparx.app",ibi:"app.sparx.broxus.com",isi:"6670219321"})},name:"SparX Wallet"}}),zt=()=>({connector:new j,id:"EverWallet",info:{description:"Premier wallet for the Everscale",icon:Dt,links:{android:"https://play.google.com/store/apps/details?id=com.broxus.crystal.app",chromeExtension:"https://chrome.google.com/webstore/detail/ever-wallet/cgeeodpfagjceefieflmdfphplkenlfk",firefoxExtension:"https://addons.mozilla.org/en-GB/firefox/addon/ever-wallet/",homepage:"https://everwallet.net/",ios:"https://apps.apple.com/us/app/ever-wallet-everscale/id1581310780"},name:"Ever Wallet"}}),Bt=()=>({connector:new L,id:"VenomWallet",info:{description:"Safe, reliable, and 100% yours",icon:Wt,links:{android:"https://play.google.com/store/apps/details?id=com.venom.wallet",chromeExtension:"https://chrome.google.com/webstore/detail/venom-wallet/ojggmchlghnjlapmfbnjholfjkiidbch",homepage:"https://venomwallet.com/",ios:"https://apps.apple.com/app/venom-blockchain-wallet/id1622970889",universalLink:Vt("https://venomwallet.page.link",{apn:"com.venom.wallet",ibi:"foundation.venom.wallet",isi:"1622970889"})},name:"Venom Wallet"}});function Vt(i,t){return[i,Fe({apn:t.apn,ibi:t.ibi,isi:t.isi,link:t.link||encodeURIComponent(window.location.href)})].join("?")}var An={connection:{type:"jrpc",data:{endpoint:"https://jrpc.everwallet.net"}},name:"Everscale",networkId:42,config:{symbol:"EVER",explorerBaseUrl:"https://everscan.io",tokensManifestUrl:"https://raw.githubusercontent.com/broxus/ton-assets/master/manifest.json"}},Pn={connection:{type:"jrpc",data:{endpoint:"https://jrpc.venom.foundation"}},name:"Everscale",networkId:1,config:{symbol:"VENOM",explorerBaseUrl:"https://venomscan.com",tokensManifestUrl:"https://cdn.venom.foundation/assets/mainnet/manifest.json"}},_n={connection:{type:"proto",data:{endpoint:"https://rpc.hamster.network"}},name:"Hamster Network",networkId:7,config:{explorerBaseUrl:"http://hamsterscan.io",tokensManifestUrl:"https://raw.githubusercontent.com/broxus/ton-assets/refs/heads/hmstr/manifest.json",symbol:"HMSTR"}},xn={connection:{type:"proto",data:{endpoint:"https://rpc-testnet.tychoprotocol.com/proto"}},name:"Tycho Testnet",networkId:2e3,config:{explorerBaseUrl:"https://testnet.tychoprotocol.com",tokensManifestUrl:"https://raw.githubusercontent.com/broxus/ton-assets/refs/heads/tychotestnet/manifest.json",symbol:"TYCHO"}},Nn={connection:{type:"jrpc",data:{endpoint:"https://jrpc-ton.broxus.com"}},name:"TON",networkId:-239,config:{explorerBaseUrl:"https://tonviewer.com",tokensManifestUrl:"https://raw.githubusercontent.com/broxus/ton-assets/refs/heads/ton-prod/manifest.json",symbol:"TON"}};var kn={id:42,type:"jrpc",data:{endpoint:"https://jrpc.everwallet.net"}},jn={id:1,type:"jrpc",data:{endpoint:"https://jrpc.venom.foundation"}},Tn={id:7,type:"jrpc",data:{endpoint:"https://rpc.hamster.network"}},Ln={id:2e3,type:"jrpc",data:{endpoint:"https://rpc-testnet.tychoprotocol.com"}},Rn={id:-239,type:"jrpc",data:{endpoint:"https://jrpc-ton.broxus.com"}};var Zt=class{constructor(t){this.params=t;this.root=document.createElement("div"),this.root.classList.add("tvm-connect-ui-root"),document.body.append(this.root);let e=U(),n=[],r="",o=Ft();if(kt(o)){let a=zt();r=a.id,n.push(a)}if(jt(o)){let a=at();r=a.id,n.push(a)}if(Tt(o)){let a=Bt();r=a.id,n.push(a)}if(!n.length){let a=t.providers;r=a?.length===1?a[0].id:e?.providerId,n=a?.length?a:[at()]}this.tvmWallet=new d({autoInit:!0,providers:n,providerId:r}),this.hasProvider=Object.fromEntries(this.tvmWallet.providers.map(a=>[a.id,!1])),Qe(this,{},{autoBind:!0}),ct(()=>this.tvmWallet.providers.map(a=>a.connector.provider),this.syncHasProvider,{fireImmediately:!0}),ct(()=>this.state,()=>{this.subscribers.forEach(a=>{a(this.state)})},{fireImmediately:!0}),ct(()=>this.tvmWallet.chainId,this.syncNetworkId,{fireImmediately:!0}),He(()=>{this.render()})}itemTemplate=t=>{let e=this.hasProvider[t.id],n=this.isInitializing[t.id],r=t.info.links?.homepage,o=t.info.links?.universalLink,[a,l]=Mt({...t.info.links})??[],_=U();return m` ${!e&&n?m`<button class=${$t({"tvm-connect-ui-item":!0,"tvm-connect-ui-item-disabled":!0})} >${t.info.icon?m`<img class="tvm-connect-ui-item-icon" src=${t.info.icon} alt="" />`:null}<div class="tvm-connect-ui-item-info"><div class="tvm-connect-ui-item-name">${t.info.name}</div><div class="tvm-connect-ui-item-desc">Initializing...</div></div></button>`:this.isMobile&&!e&&o?m`<a target="_blank" rel="noopener noreferrer" class="tvm-connect-ui-item" href=${o}>${t.info.icon?m`<img class="tvm-connect-ui-item-icon" src=${t.info.icon} alt="" />`:null}<div class="tvm-connect-ui-item-info"><div class="tvm-connect-ui-item-name">${t.info.name}</div>${t.info.description?m`<div class="tvm-connect-ui-item-desc">${t.info.description}</div>`:null}</div></a>`:e?m`<button class="tvm-connect-ui-item" @click=${this.selectProvider.bind(this,t.id)}>${t.info.icon?m`<img class="tvm-connect-ui-item-icon" src=${t.info.icon} alt="" />`:null}<div class="tvm-connect-ui-item-info"><div class="tvm-connect-ui-item-name">${t.info.name}</div>${t.info.description?m`<div class="tvm-connect-ui-item-desc">${t.info.description}</div>`:null}</div>${this.providerId===t.id?m`<div class="tvm-connect-ui-item-label">Connected</div>`:_&&_.providerId===t.id?m`<div class="tvm-connect-ui-item-label">Recent</div>`:null}</button>`:m`<a target="_blank" rel="noopener noreferrer" class=${$t({"tvm-connect-ui-item-disabled":!l&&!r,"tvm-connect-ui-item":!0})} href=${Ye(l??r)} >${t.info.icon?m`<img class="tvm-connect-ui-item-icon" src=${t.info.icon} alt="" />`:null}<div class="tvm-connect-ui-item-info"><div class="tvm-connect-ui-item-name">Install ${t.info.name}</div>${t.info.description?m`<div class="tvm-connect-ui-item-desc">${t.info.description}</div>`:null}</div></a>`} `};providerTemplate=()=>{if(!this.selectedProvider)return Ze;let t=()=>{this.disconnect(),this.resetselectedProvider()};return m`<button tabindex="0" class="tvm-connect-ui-back" @click=${this.resetselectedProvider}><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor" ><path d="m289.18-445.54 214.05 213.8q9.85 10.15 10.23 24.19.39 14.04-9.43 24.41-10.49 10.73-24.7 10.66-14.2-.06-24.02-10.55L186.87-451.47q-6.23-5.56-9-12.54-2.77-6.98-2.77-15.69 0-8.04 2.77-14.99 2.77-6.95 9-12.51l269.77-269.77q10.23-10.23 24.18-10.43 13.95-.19 24.54 10.43 9.82 10.59 9.82 24.34 0 13.76-9.82 23.32L289.18-513.13h478.69q13.87 0 23.66 9.8 9.8 9.8 9.8 23.67 0 14.53-9.8 24.33-9.79 9.79-23.66 9.79H289.18Z" /></svg></button><div class="tvm-connect-ui-provider"><div class="tvm-connect-ui-provider-info">${this.selectedProvider.info.icon?m`<img class="tvm-connect-ui-provider-icon" src=${this.selectedProvider.info.icon} alt="" />`:null} ${this.selectedProvider.info.description?m`<div class="tvm-connect-ui-provider-desc">${this.selectedProvider.info.description}</div>`:null}</div>${this.providerId===this.selectedProvider.id?m`<div class="tvm-connect-ui-provider-status"><div class="tvm-connect-ui-provider-hint">${this.selectedProvider.info.name} is connected </div><button class="tvm-connect-ui-provider-btn" @click=${t}>Disconnect</button></div>`:this.selectedProviderError?m`<div class="tvm-connect-ui-provider-status"><div class="tvm-connect-ui-provider-error">Connection failed</div><div class="tvm-connect-ui-provider-text"> The request was rejected, please try again </div><button class="tvm-connect-ui-provider-btn" @click=${this.selectProvider.bind(this,this.selectedProvider.id)} > Try again </button></div>`:m`<div class="tvm-connect-ui-provider-status"><div class="tvm-connect-ui-provider-hint"> Continue in ${this.selectedProvider.info.name}</div><div class="tvm-connect-ui-provider-text">Accept connection request in the wallet</div></div>`}</div>`};rootTemplate=()=>{let t=U();return m`<div class="tvm-connect-ui-overlay" @click=${this.hide}></div><div class="tvm-connect-ui-popup"><button class="tvm-connect-ui-close" tabindex="0" @click=${this.hide}><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor" ><path d="M480-437.85 277.08-234.92q-8.31 8.3-20.89 8.5-12.57.19-21.27-8.5-8.69-8.7-8.69-21.08 0-12.38 8.69-21.08L437.85-480 234.92-682.92q-8.3-8.31-8.5-20.89-.19-12.57 8.5-21.27 8.7-8.69 21.08-8.69 12.38 0 21.08 8.69L480-522.15l202.92-202.93q8.31-8.3 20.89-8.5 12.57-.19 21.27 8.5 8.69 8.7 8.69 21.08 0 12.38-8.69 21.08L522.15-480l202.93 202.92q8.3 8.31 8.5 20.89.19 12.57-8.5 21.27-8.7 8.69-21.08 8.69-12.38 0-21.08-8.69L480-437.85Z" /></svg></button><div class="tvm-connect-ui-title">Connect a wallet</div>${this.selectedProvider?this.providerTemplate():m`<div class="tvm-connect-ui-list">${Array.from(this.tvmWallet.providers).sort((e,n)=>e.id===t?.providerId?-1:n.id===t?.providerId?1:0).map(e=>this.itemTemplate(e))}</div>`}</div>`};tvmWallet;root;visible=!1;selectedProviderId=void 0;selectedNetwork=void 0;hasProvider;isMobile=qe(Ft());subscribers=[];networkId=void 0;selectedProviderError=void 0;providers=[];resetselectedProvider(){this.selectedProviderId=void 0,this.selectedProviderError=void 0}async selectProvider(t){try{if(this.selectedProviderId=t,this.providerId===t)return;let e=this.tvmWallet.connector,n=this.tvmWallet.providers.find(r=>r.id===t);if(!n)throw new Error("Provider not founded");await n.connector.connect(this.selectedNetwork),this.tvmWallet.providerId&&t!==this.tvmWallet.providerId&&await e?.disconnect(!0),ot({providerId:t,type:n.connector.type}),this.tvmWallet.setState("providerId",t),this.hide()}catch(e){this.selectedProviderError=e,console.error(e)}}async syncHasProvider(){let t=await Promise.all(this.tvmWallet.providers.map(async e=>{try{if(e.connector.provider instanceof Xe&&typeof e.connector.provider?.hasProvider=="function"){let n=await e.connector.provider.hasProvider();return[e.id,n]}else return[e.id,e.connector.provider!=null]}catch(n){return console.error(n),[e.id,!1]}}));Ut(()=>{this.hasProvider=Object.fromEntries(t)})}async syncNetworkId(){let t;try{t=(await this.getProvider()?.getProviderState())?.networkId}catch(e){console.error(e)}Ut(()=>{this.networkId=t})}render(){Ge(this.rootTemplate(),this.root),this.root.classList.toggle("tvm-connect-ui-root-active",this.visible)}show(){this.resetselectedProvider(),this.visible=!0}hide(){this.visible=!1}get selectedProvider(){return this.tvmWallet.providers.find(t=>t.id===this.selectedProviderId)}get isInitializing(){return Object.fromEntries(this.tvmWallet.providers.map(t=>[t.id,t.connector.isInitializing===void 0||t.connector.isInitializing]))}get balance(){return this.tvmWallet.balance}get providerId(){return this.isReady?this.tvmWallet.providerId:void 0}get address(){return this.tvmWallet.address?.toString()}get account(){return this.tvmWallet.account}get isReady(){return this.tvmWallet.isReady}get isUnsupportedNetwork(){return this.params.networks&&this.params.networks.length>0&&this.networkId!==void 0?this.params.networks.every(t=>t.networkId!==this.networkId):!1}get isLoading(){return!!this.tvmWallet.isInitializing||!!this.tvmWallet.isConnecting}get state(){return{providerId:this.providerId,networkId:this.networkId,account:this.account,address:this.address,balance:this.balance,isReady:this.isReady,isLoading:this.isLoading,isUnsupportedNetwork:this.isUnsupportedNetwork,isPopupVisible:this.visible,isInitializing:this.tvmWallet.isInitializing===!0,isNotInstalled:Object.values(this.isInitializing).every(t=>t===!1)&&Object.values(this.hasProvider).every(t=>t===!1)}}connect(t){if(this.selectedNetwork=t,this.tvmWallet.providers.length>1)this.show();else{let e=this.tvmWallet.providers.at(0);e?this.selectProvider(e.id):console.warn("Provider must be defined")}}disconnect(){this.tvmWallet.disconnect(!0)}switchNetwork(t){return this.tvmWallet.switchNetwork(t)}addNetwork(t){return this.tvmWallet.addNetwork(t)}changeAccount(){return this.tvmWallet.provider?.changeAccount()}getProvider(){return this.tvmWallet.provider}getState(){return{...this.state}}subscribe(t){let e=this.subscribers.push(t);return t(this.getState()),()=>{this.subscribers.splice(e-1,1)}}};export{Zt as TvmConnectUI,zt as everWallet,kn as everscaleConnection,An as everscaleNetwork,Tn as hamsterConnection,_n as hamsterNetwork,at as sparxWallet,Rn as tonConnection,Nn as tonNetwork,Ln as tychoTestnetConnection,xn as tychoTestnetNetwork,jn as venomConnection,Pn as venomNetwork,Bt as venomWallet};
